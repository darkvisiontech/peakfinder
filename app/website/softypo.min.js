(()=>{var xt=Object.create;var ze=Object.defineProperty;var pt=Object.getOwnPropertyDescriptor;var gt=Object.getOwnPropertyNames;var dt=Object.getPrototypeOf,wt=Object.prototype.hasOwnProperty;var Ce=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var yt=(n,e,r,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of gt(e))!wt.call(n,o)&&o!==r&&ze(n,o,{get:()=>e[o],enumerable:!(l=pt(e,o))||l.enumerable});return n};var Xe=(n,e,r)=>(r=n!=null?xt(dt(n)):{},yt(e||!n||!n.__esModule?ze(r,"default",{value:n,enumerable:!0}):r,n));var je=Ce((Ae,qe)=>{(function(n,e){typeof Ae=="object"&&typeof qe<"u"?e(Ae):typeof define=="function"&&define.amd?define(["exports"],e):e(n.d3_array={})})(Ae,function(n){"use strict";function e(f,d){return f<d?-1:f>d?1:f>=d?0:NaN}function r(f){return f.length===1&&(f=l(f)),{left:function(d,p,w,h){for(w==null&&(w=0),h==null&&(h=d.length);w<h;){var a=w+h>>>1;f(d[a],p)<0?w=a+1:h=a}return w},right:function(d,p,w,h){for(w==null&&(w=0),h==null&&(h=d.length);w<h;){var a=w+h>>>1;f(d[a],p)>0?h=a:w=a+1}return w}}}function l(f){return function(d,p){return e(f(d),p)}}var o=r(e),t=o.right,s=o.left;function m(f,d){return d<f?-1:d>f?1:d>=f?0:NaN}function c(f){return f===null?NaN:+f}function g(f,d){var p=f.length,w=0,h,a,E=0,V=-1,W=0;if(d==null)for(;++V<p;)isNaN(h=c(f[V]))||(a=h-w,w+=a/++W,E+=a*(h-w));else for(;++V<p;)isNaN(h=c(d(f[V],V,f)))||(a=h-w,w+=a/++W,E+=a*(h-w));if(W>1)return E/(W-1)}function M(f,d){var p=g(f,d);return p&&Math.sqrt(p)}function b(f,d){var p=-1,w=f.length,h,a,E;if(d==null){for(;++p<w;)if((a=f[p])!=null&&a>=a){h=E=a;break}for(;++p<w;)(a=f[p])!=null&&(h>a&&(h=a),E<a&&(E=a))}else{for(;++p<w;)if((a=d(f[p],p,f))!=null&&a>=a){h=E=a;break}for(;++p<w;)(a=d(f[p],p,f))!=null&&(h>a&&(h=a),E<a&&(E=a))}return[h,E]}function A(f){return function(){return f}}function v(f){return f}function F(f,d,p){f=+f,d=+d,p=(h=arguments.length)<2?(d=f,f=0,1):h<3?1:+p;for(var w=-1,h=Math.max(0,Math.ceil((d-f)/p))|0,a=new Array(h);++w<h;)a[w]=f+w*p;return a}var u=Math.sqrt(50),S=Math.sqrt(10),N=Math.sqrt(2);function T(f,d,p){var w=D(f,d,p);return F(Math.ceil(f/w)*w,Math.floor(d/w)*w+w/2,w)}function D(f,d,p){var w=Math.abs(d-f)/Math.max(0,p),h=Math.pow(10,Math.floor(Math.log(w)/Math.LN10)),a=w/h;return a>=u?h*=10:a>=S?h*=5:a>=N&&(h*=2),d<f?-h:h}function P(f){return Math.ceil(Math.log(f.length)/Math.LN2)+1}function C(f){return+f}function j(){var f=v,d=b,p=P;function w(h){var a,E=h.length,V,W=new Array(E);for(a=0;a<E;++a)W[a]=+f(h[a],a,h);var me=d(W),ee=+me[0],te=+me[1],X=p(W,ee,te);Array.isArray(X)||(X=T(ee,te,+X));var Q=X.length;for(a=0;a<Q;++a)X[a]=+X[a];for(;X[0]<=ee;)X.shift(),--Q;for(;X[Q-1]>=te;)X.pop(),--Q;var he=new Array(Q+1),ce;for(a=0;a<=Q;++a)ce=he[a]=[],ce.x0=a>0?X[a-1]:ee,ce.x1=a<Q?X[a]:te;for(a=0;a<E;++a)V=W[a],ee<=V&&V<=te&&he[t(X,V,0,Q)].push(h[a]);return he}return w.value=function(h){return arguments.length?(f=typeof h=="function"?h:A(+h),w):f},w.domain=function(h){return arguments.length?(d=typeof h=="function"?h:A([+h[0],+h[1]]),w):d},w.thresholds=function(h){return arguments.length?(p=typeof h=="function"?h:Array.isArray(h)?A(Array.prototype.map.call(h,C)):A(+h),w):p},w}function _(f,d,p){if(p==null&&(p=c),!!(w=f.length)){if((d=+d)<=0||w<2)return+p(f[0],0,f);if(d>=1)return+p(f[w-1],w-1,f);var w,h=(w-1)*d,a=Math.floor(h),E=+p(f[a],a,f),V=+p(f[a+1],a+1,f);return E+(V-E)*(h-a)}}function O(f,d,p){return f.sort(e),Math.ceil((p-d)/(2*(_(f,.75)-_(f,.25))*Math.pow(f.length,-1/3)))}function Z(f,d,p){return Math.ceil((p-d)/(3.5*M(f)*Math.pow(f.length,-1/3)))}function G(f,d){var p=-1,w=f.length,h,a;if(d==null){for(;++p<w;)if((a=f[p])!=null&&a>=a){h=a;break}for(;++p<w;)(a=f[p])!=null&&a>h&&(h=a)}else{for(;++p<w;)if((a=d(f[p],p,f))!=null&&a>=a){h=a;break}for(;++p<w;)(a=d(f[p],p,f))!=null&&a>h&&(h=a)}return h}function I(f,d){var p=0,w=f.length,h,a=-1,E=w;if(d==null)for(;++a<w;)isNaN(h=c(f[a]))?--E:p+=h;else for(;++a<w;)isNaN(h=c(d(f[a],a,f)))?--E:p+=h;if(E)return p/E}function B(f,d){var p=[],w=f.length,h,a=-1;if(d==null)for(;++a<w;)isNaN(h=c(f[a]))||p.push(h);else for(;++a<w;)isNaN(h=c(d(f[a],a,f)))||p.push(h);return _(p.sort(e),.5)}function z(f){for(var d=f.length,p,w=-1,h=0,a,E;++w<d;)h+=f[w].length;for(a=new Array(h);--d>=0;)for(E=f[d],p=E.length;--p>=0;)a[--h]=E[p];return a}function R(f,d){var p=-1,w=f.length,h,a;if(d==null){for(;++p<w;)if((a=f[p])!=null&&a>=a){h=a;break}for(;++p<w;)(a=f[p])!=null&&h>a&&(h=a)}else{for(;++p<w;)if((a=d(f[p],p,f))!=null&&a>=a){h=a;break}for(;++p<w;)(a=d(f[p],p,f))!=null&&h>a&&(h=a)}return h}function J(f){for(var d=0,p=f.length-1,w=f[0],h=new Array(p<0?0:p);d<p;)h[d]=[w,w=f[++d]];return h}function H(f,d){for(var p=d.length,w=new Array(p);p--;)w[p]=f[d[p]];return w}function K(f,d){if(w=f.length){var p=0,w,h=0,a,E=f[h];for(d||(d=e);++p<w;)(d(a=f[p],E)<0||d(E,E)!==0)&&(E=a,h=p);if(d(E,E)===0)return h}}function le(f,d,p){for(var w=(p??f.length)-(d=d==null?0:+d),h,a;w;)a=Math.random()*w--|0,h=f[w+d],f[w+d]=f[a+d],f[a+d]=h;return f}function se(f,d){var p=0,w=f.length,h,a=-1;if(d==null)for(;++a<w;)(h=+f[a])&&(p+=h);else for(;++a<w;)(h=+d(f[a],a,f))&&(p+=h);return p}function oe(f){if(!(a=f.length))return[];for(var d=-1,p=R(f,fe),w=new Array(p);++d<p;)for(var h=-1,a,E=w[d]=new Array(a);++h<a;)E[h]=f[h][d];return w}function fe(f){return f.length}function ae(){return oe(arguments)}var ue="0.7.1";n.version=ue,n.bisect=t,n.bisectRight=t,n.bisectLeft=s,n.ascending=e,n.bisector=r,n.descending=m,n.deviation=M,n.extent=b,n.histogram=j,n.thresholdFreedmanDiaconis=O,n.thresholdScott=Z,n.thresholdSturges=P,n.max=G,n.mean=I,n.median=B,n.merge=z,n.min=R,n.pairs=J,n.permute=H,n.quantile=_,n.range=F,n.scan=K,n.shuffle=le,n.sum=se,n.ticks=T,n.tickStep=D,n.transpose=oe,n.variance=g,n.zip=ae})});var We=Ce(($t,Ge)=>{var{bisectRight:At}=je(),It=(n,e,r,l)=>{let o=n.length-1;n[0]=0,e[0]=0,r[0]=0,e[1]=e[1]/n[1],r[1]=r[1]/n[1];for(let t=2;t<o;++t)n[t]=n[t]-n[t-2]*r[t-2]*r[t-2]-n[t-1]*e[t-1]*e[t-1],e[t]=(e[t]-n[t-1]*e[t-1]*r[t-1])/n[t],r[t]=r[t]/n[t];for(let t=2;t<o;++t)l[t]=l[t]-e[t-1]*l[t-1]-r[t-2]*l[t-2];for(let t=1;t<o;++t)l[t]=l[t]/n[t];l[o-2]=l[o-2]-e[o-2]*l[o-1];for(let t=o-3;t>0;--t)l[t]=l[t]-e[t]*l[t+1]-r[t]*l[t+2]},Ft=(n,e,r,l)=>{let o=n.length-1,t=new Array(o+1),s=new Array(o+1),m=new Array(o+1),c=new Array(o+1),g=new Array(o+1),M=new Array(o+1),b=new Array(o+1),A=new Array(o+1),v=n.map(()=>[0,0,0,0]);v.pop();let F=2*(1-l)/(3*l);for(let u=0;u<o;++u)t[u]=n[u+1]-n[u],s[u]=3/t[u];g[0]=0;for(let u=1;u<o;++u)m[u]=-(s[u-1]+s[u]),c[u]=2*(n[u+1]-n[u-1]),g[u]=3*(e[u+1]-e[u])/t[u]-3*(e[u]-e[u-1])/t[u-1];g[o]=0;for(let u=1;u<o;++u)M[u]=s[u-1]*s[u-1]*r[u-1]+m[u]*m[u]*r[u]+s[u]*s[u]*r[u+1],M[u]=F*M[u]+c[u];for(let u=1;u<o-1;++u)b[u]=m[u]*s[u]*r[u]+s[u]*m[u+1]*r[u+1],b[u]=F*b[u]+t[u];for(let u=1;u<o-2;++u)A[u]=F*s[u]*s[u+1]*r[u+1];It(M,b,A,g),v[0][3]=e[0]-F*s[0]*g[1]*r[0],v[1][3]=e[1]-F*(m[1]*g[1]+s[1]*g[2])*r[0],v[0][0]=g[1]/(3*t[0]),v[0][1]=0,v[0][2]=(v[1][3]-v[0][3])/t[0]-g[1]*t[0]/3,s[0]=0;for(let u=1;u<o;++u)v[u][0]=(g[u+1]-g[u])/(3*t[u]),v[u][1]=g[u],v[u][2]=(g[u]+g[u-1])*t[u-1]+v[u-1][2],v[u][3]=s[u-1]*g[u-1]+m[u]*g[u]+s[u]*g[u+1],v[u][3]=e[u]-F*v[u][3]*r[u];return v},_e=class{constructor(e,r,l=1){let o=e.map((g,M)=>M);o.sort((g,M)=>e[g]-e[M]);let t=o.map(g=>e[g]),s=o.map(g=>r[g]),m=o.length,c=o.map(()=>1);this.n=m,this.x=t,this.y=s,this.params=Ft(t,s,c,l)}interpolate(e){if(e===this.x[this.n-1])return this.y[this.n-1];let r=Math.min(Math.max(0,At(this.x,e)-1),this.n-2),[l,o,t,s]=this.params[r];return e=e-this.x[r],l*e*e*e+o*e*e+t*e+s}max(e=100){let r=this.x[0],o=(this.x[this.n-1]-r)/e,t=-1/0;for(let s=0,m=r;s<e;++s,m+=o){let c=this.interpolate(m);c>t&&(t=c)}return t}min(e=100){let r=this.x[0],o=(this.x[this.n-1]-r)/e,t=1/0;for(let s=0,m=r;s<e;++s,m+=o){let c=this.interpolate(m);c<t&&(t=c)}return t}domain(){return[this.x[0],this.x[this.x.length-1]]}range(){return[this.min(),this.max()]}curve(e,r=null){r=r||this.domain();let l=(r[1]-r[0])/(e-1),o=new Array(e);for(let t=0;t<e;++t){let s=l*t+r[0];o[t]=[s,this.interpolate(s)]}return o}};Ge.exports=_e});var Ue=Ce((cr,He)=>{"use strict";function U(n){if(this.size=n|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=n<<1;for(var e=new Array(this.size*2),r=0;r<e.length;r+=2){let c=Math.PI*r/this.size;e[r]=Math.cos(c),e[r+1]=-Math.sin(c)}this.table=e;for(var l=0,o=1;this.size>o;o<<=1)l++;this._width=l%2===0?l-1:l,this._bitrev=new Array(1<<this._width);for(var t=0;t<this._bitrev.length;t++){this._bitrev[t]=0;for(var s=0;s<this._width;s+=2){var m=this._width-s-2;this._bitrev[t]|=(t>>>s&3)<<m}}this._out=null,this._data=null,this._inv=0}He.exports=U;U.prototype.fromComplexArray=function(e,r){for(var l=r||new Array(e.length>>>1),o=0;o<e.length;o+=2)l[o>>>1]=e[o];return l};U.prototype.createComplexArray=function(){let e=new Array(this._csize);for(var r=0;r<e.length;r++)e[r]=0;return e};U.prototype.toComplexArray=function(e,r){for(var l=r||this.createComplexArray(),o=0;o<l.length;o+=2)l[o]=e[o>>>1],l[o+1]=0;return l};U.prototype.completeSpectrum=function(e){for(var r=this._csize,l=r>>>1,o=2;o<l;o+=2)e[r-o]=e[o],e[r-o+1]=-e[o+1]};U.prototype.transform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null};U.prototype.realTransform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null};U.prototype.inverseTransform=function(e,r){if(e===r)throw new Error("Input and output buffers must be different");this._out=e,this._data=r,this._inv=1,this._transform4();for(var l=0;l<e.length;l++)e[l]/=this.size;this._out=null,this._data=null};U.prototype._transform4=function(){var e=this._out,r=this._csize,l=this._width,o=1<<l,t=r/o<<1,s,m,c=this._bitrev;if(t===4)for(s=0,m=0;s<r;s+=t,m++){let u=c[m];this._singleTransform2(s,u,o)}else for(s=0,m=0;s<r;s+=t,m++){let u=c[m];this._singleTransform4(s,u,o)}var g=this._inv?-1:1,M=this.table;for(o>>=2;o>=2;o>>=2){t=r/o<<1;var b=t>>>2;for(s=0;s<r;s+=t)for(var A=s+b,v=s,F=0;v<A;v+=2,F+=o){let u=v,S=u+b,N=S+b,T=N+b,D=e[u],P=e[u+1],C=e[S],j=e[S+1],_=e[N],O=e[N+1],Z=e[T],G=e[T+1],I=D,B=P,z=M[F],R=g*M[F+1],J=C*z-j*R,H=C*R+j*z,K=M[2*F],le=g*M[2*F+1],se=_*K-O*le,oe=_*le+O*K,fe=M[3*F],ae=g*M[3*F+1],ue=Z*fe-G*ae,f=Z*ae+G*fe,d=I+se,p=B+oe,w=I-se,h=B-oe,a=J+ue,E=H+f,V=g*(J-ue),W=g*(H-f),me=d+a,ee=p+E,te=d-a,X=p-E,Q=w+W,he=h-V,ce=w-W,Ne=h+V;e[u]=me,e[u+1]=ee,e[S]=Q,e[S+1]=he,e[N]=te,e[N+1]=X,e[T]=ce,e[T+1]=Ne}}};U.prototype._singleTransform2=function(e,r,l){let o=this._out,t=this._data,s=t[r],m=t[r+1],c=t[r+l],g=t[r+l+1],M=s+c,b=m+g,A=s-c,v=m-g;o[e]=M,o[e+1]=b,o[e+2]=A,o[e+3]=v};U.prototype._singleTransform4=function(e,r,l){let o=this._out,t=this._data,s=this._inv?-1:1,m=l*2,c=l*3,g=t[r],M=t[r+1],b=t[r+l],A=t[r+l+1],v=t[r+m],F=t[r+m+1],u=t[r+c],S=t[r+c+1],N=g+v,T=M+F,D=g-v,P=M-F,C=b+u,j=A+S,_=s*(b-u),O=s*(A-S),Z=N+C,G=T+j,I=D+O,B=P-_,z=N-C,R=T-j,J=D-O,H=P+_;o[e]=Z,o[e+1]=G,o[e+2]=I,o[e+3]=B,o[e+4]=z,o[e+5]=R,o[e+6]=J,o[e+7]=H};U.prototype._realTransform4=function(){var e=this._out,r=this._csize,l=this._width,o=1<<l,t=r/o<<1,s,m,c=this._bitrev;if(t===4)for(s=0,m=0;s<r;s+=t,m++){let Te=c[m];this._singleRealTransform2(s,Te>>>1,o>>>1)}else for(s=0,m=0;s<r;s+=t,m++){let Te=c[m];this._singleRealTransform4(s,Te>>>1,o>>>1)}var g=this._inv?-1:1,M=this.table;for(o>>=2;o>=2;o>>=2){t=r/o<<1;var b=t>>>1,A=b>>>1,v=A>>>1;for(s=0;s<r;s+=t)for(var F=0,u=0;F<=v;F+=2,u+=o){var S=s+F,N=S+A,T=N+A,D=T+A,P=e[S],C=e[S+1],j=e[N],_=e[N+1],O=e[T],Z=e[T+1],G=e[D],I=e[D+1],B=P,z=C,R=M[u],J=g*M[u+1],H=j*R-_*J,K=j*J+_*R,le=M[2*u],se=g*M[2*u+1],oe=O*le-Z*se,fe=O*se+Z*le,ae=M[3*u],ue=g*M[3*u+1],f=G*ae-I*ue,d=G*ue+I*ae,p=B+oe,w=z+fe,h=B-oe,a=z-fe,E=H+f,V=K+d,W=g*(H-f),me=g*(K-d),ee=p+E,te=w+V,X=h+me,Q=a-W;if(e[S]=ee,e[S+1]=te,e[N]=X,e[N+1]=Q,F===0){var he=p-E,ce=w-V;e[T]=he,e[T+1]=ce;continue}if(F!==v){var Ne=h,nt=-a,ot=p,it=-w,lt=-g*me,st=-g*W,ft=-g*V,at=-g*E,ut=Ne+lt,mt=nt+st,ht=ot+at,ct=it-ft,Ye=s+A-F,Oe=s+b-F;e[Ye]=ut,e[Ye+1]=mt,e[Oe]=ht,e[Oe+1]=ct}}}};U.prototype._singleRealTransform2=function(e,r,l){let o=this._out,t=this._data,s=t[r],m=t[r+l],c=s+m,g=s-m;o[e]=c,o[e+1]=0,o[e+2]=g,o[e+3]=0};U.prototype._singleRealTransform4=function(e,r,l){let o=this._out,t=this._data,s=this._inv?-1:1,m=l*2,c=l*3,g=t[r],M=t[r+l],b=t[r+m],A=t[r+c],v=g+b,F=g-b,u=M+A,S=s*(M-A),N=v+u,T=F,D=-S,P=v-u,C=F,j=S;o[e]=N,o[e+1]=0,o[e+2]=T,o[e+3]=D,o[e+4]=P,o[e+5]=0,o[e+6]=C,o[e+7]=j}});var xe=256,be=[],Me;for(;xe--;)be[xe]=(xe+256).toString(16).substring(1);function de(){var n=0,e,r="";if(!Me||xe+16>256){for(Me=Array(n=256);n--;)Me[n]=256*Math.random()|0;n=xe=0}for(;n<16;n++)e=Me[xe+n],n==6?r+=be[e&15|64]:n==8?r+=be[e&63|128]:r+=be[e],n&1&&n>1&&n<11&&(r+="-");return xe++,r}var vt=Object.prototype.toString;function L(n){let e=vt.call(n);return e.endsWith("Array]")&&!e.includes("Big")}function pe(n,e,r={}){let{windowSize:l=9,derivative:o=0,polynomial:t=3}=r;if(l%2===0||l<5||!Number.isInteger(l))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(!L(n))throw new TypeError("Y values must be an array");if(typeof e>"u")throw new TypeError("X must be defined");if(l>n.length)throw new RangeError(`Window size is higher than the data length ${l}>${n.length}`);if(o<0||!Number.isInteger(o))throw new RangeError("Derivative should be a positive integer");if(t<1||!Number.isInteger(t))throw new RangeError("Polynomial should be a positive integer");t>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");let s=Math.floor(l/2),m=n.length,c=new Float64Array(m),g=bt(l,t,o),M=0,b=!0;L(e)?b=!1:M=Math.pow(e,o);for(let v=0;v<s;v++){let F=g[s-v-1],u=g[s+v+1],S=0,N=0;for(let T=0;T<l;T++)S+=F[T]*n[T],N+=u[T]*n[m-l+T];b?(c[s-v-1]=S/M,c[m-s+v]=N/M):(M=Pe(e,s-v-1,s,o),c[s-v-1]=S/M,M=Pe(e,m-s+v,s,o),c[m-s+v]=N/M)}let A=g[s];for(let v=l;v<=m;v++){let F=0;for(let u=0;u<l;u++)F+=A[u]*n[u+v-l];b||(M=Pe(e,v-s-1,s,o)),c[v-s-1]=F/M}return c}function Pe(n,e,r,l){let o=0,t=0;for(let s=e-r;s<e+r;s++)s>=0&&s<n.length-1&&(o+=n[s+1]-n[s],t++);return Math.pow(o/t,l)}function ye(n,e,r,l){let o=0;return r>0?o=(4*r-2)/(r*(2*e-r+1))*(n*ye(n,e,r-1,l)+l*ye(n,e,r-1,l-1))-(r-1)*(2*e+r)/(r*(2*e-r+1))*ye(n,e,r-2,l):r===0&&l===0?o=1:o=0,o}function Le(n,e){let r=1;if(n>=e)for(let l=n-e+1;l<=n;l++)r*=l;return r}function Mt(n,e,r,l,o){let t=0;for(let s=0;s<=l;s++)t+=(2*s+1)*(Le(2*r,s)/Le(2*r+s+1,s+1))*ye(n,r,s,0)*ye(e,r,s,o);return t}function bt(n,e,r){let l=new Array(n),o=Math.floor(n/2);for(let t=-o;t<=o;t++){l[t+o]=new Float64Array(n);for(let s=-o;s<=o;s++)l[t+o][s+o]=Mt(s,t,o,e,r)}return l}var Et=Xe(We());var St=Xe(Ue());function ie(n){if(!L(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");let e=n.slice(),r=0,l=e.length-1,o=0,t=0,s=0,m=$e(r,l);for(;;){if(l<=r)return e[m];if(l===r+1)return e[r]>e[l]&&ge(e,r,l),e[m];for(o=$e(r,l),e[o]>e[l]&&ge(e,o,l),e[r]>e[l]&&ge(e,r,l),e[o]>e[r]&&ge(e,o,r),ge(e,o,r+1),t=r+1,s=l;;){do t++;while(e[r]>e[t]);do s--;while(e[s]>e[r]);if(s<t)break;ge(e,t,s)}ge(e,r,s),s<=m&&(r=t),s>=m&&(l=s-1)}}function ge(n,e,r){let l=n[r];n[r]=n[e],n[e]=l}function $e(n,e){return Math.floor((n+e)/2)}function Y(n,e={}){let{minLength:r}=e;if(!L(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");if(r&&n.length<r)throw new Error(`input must have a length of at least ${r}`)}function re(n,e,r={}){let{sorted:l=!0}=r;if(l){let o=0,t=n.length-1,s=0;for(;t-o>1;)if(s=o+(t-o>>1),n[s]<e)o=s;else if(n[s]>e)t=s;else return s;return o<n.length-1?Math.abs(e-n[o])<Math.abs(n[o+1]-e)?o:o+1:o}else{let o=0,t=Number.POSITIVE_INFINITY;for(let s=0;s<n.length;s++){let m=Math.abs(n[s]-e);m<t&&(t=m,o=s)}return o}}function q(n,e={}){let{fromIndex:r,toIndex:l,from:o,to:t}=e;return r===void 0&&(o!==void 0?r=re(n,o):r=0),l===void 0&&(t!==void 0?l=re(n,t):l=n.length-1),r<0&&(r=0),l<0&&(l=0),r>=n.length&&(r=n.length-1),l>=n.length&&(l=n.length-1),r>l&&([r,l]=[l,r]),{fromIndex:r,toIndex:l}}function ne(n,e={}){Y(n);let{fromIndex:r,toIndex:l}=q(n,e),o=n[r];for(let t=r+1;t<=l;t++)n[t]>o&&(o=n[t]);return o}function we(n,e={}){Y(n);let{fromIndex:r,toIndex:l}=q(n,e),o=n[r];for(let t=r+1;t<=l;t++)n[t]<o&&(o=n[t]);return o}function Ze(n,e={}){if(n.length<3)return!0;let{tolerance:r=.05}=e,l=0,o=Number.MAX_SAFE_INTEGER;for(let t=0;t<n.length-1;++t){let s=n[t+1]-n[t];s<o&&(o=s),s>l&&(l=s)}return(l-o)/l<r}function Ie(n){if(n.length<=2)return 1;if(n[0]===n[1]){for(let e=1;e<n.length-1;e++)if(n[e]!==n[e+1])return 0;return 1}if(n[0]<n[n.length-1]){for(let e=0;e<n.length-1;e++)if(n[e]>=n[e+1])return 0;return 1}else{for(let e=0;e<n.length-1;e++)if(n[e]<=n[e+1])return 0;return-1}}function Je(n){let e=ie(n),r=new Float64Array(n.length);for(let l=0;l<n.length;l++)r[l]=Math.abs(n[l]-e);return{median:e,mad:ie(r)}}function De(n){let{mad:e,median:r}=Je(n);return{sd:e/.6744897501960817,mad:e,median:r}}function et(n,e){let{x:r,y:l}=n;for(let o of e){let t=o.index;if(l[t-1]>=l[t-2]&&l[t-1]>=l[t]?t--:l[t+1]>=l[t]&&l[t+1]>=l[t+2]?t++:l[t-2]>=l[t-3]&&l[t-2]>=l[t-1]?t-=2:l[t+2]>=l[t+1]&&l[t+2]>=l[t+3]&&(t+=2),l[t-1]>0&&l[t+1]>0&&l[t]>=l[t-1]&&l[t]>=l[t+1]&&(l[t]!==l[t-1]||l[t]!==l[t+1])){let s=20*Math.log10(l[t-1]),m=20*Math.log10(l[t]),c=20*Math.log10(l[t+1]),g=.5*(s-c)/(s-2*m+c);o.x=r[t]+(r[t]-r[t-1])*g,o.y=l[t]-.25*(l[t-1]-l[t+1])*g}}}function tt(n,e={}){let{sgOptions:r={windowSize:9,polynomial:3},noiseLevel:l,smoothY:o=!1,maxCriteria:t=!0,minMaxRatio:s=25e-5,realTopDetection:m=!1}=e,{x:c,y:g}=n;if(Ie(c)!==1)throw new Error("GSD only accepts monotone increasing x values");g=g.slice();let M=Ze(c);if(l===void 0)if(M){let I=De(g);t?l=I.median+1.5*I.sd:l=-I.median+1.5*I.sd}else l=0;else t||(l*=-1);if(!t)for(let I=0;I<g.length;I++)g[I]*=-1;if(l!==void 0)for(let I=0;I<g.length;I++)g[I]<l&&(g[I]=l);let b=g,A,v,{windowSize:F,polynomial:u}=r;M?(o&&(b=pe(g,c[1]-c[0],{windowSize:F,polynomial:u,derivative:0})),A=pe(g,c[1]-c[0],{windowSize:F,polynomial:u,derivative:1}),v=pe(g,c[1]-c[0],{windowSize:F,polynomial:u,derivative:2})):(o&&(b=pe(g,c,{windowSize:F,polynomial:u,derivative:0})),A=pe(g,c,{windowSize:F,polynomial:u,derivative:1}),v=pe(g,c,{windowSize:F,polynomial:u,derivative:2}));let S=we(b),N=ne(b);if(S>N||S===N)return[];let T=S+(N-S)*s,D=c[1]-c[0],P=null,C=null,j=[],_=[],O=[];for(let I=1;I<b.length-1;++I)(A[I]<A[I-1]&&A[I]<=A[I+1]||A[I]<=A[I-1]&&A[I]<A[I+1])&&(C={x:c[I],index:I},D>0&&P!==null&&(_.push(P),O.push(C))),(A[I]>=A[I-1]&&A[I]>A[I+1]||A[I]>A[I-1]&&A[I]>=A[I+1])&&(P={x:c[I],index:I},D<0&&C!==null&&(_.push(P),O.push(C))),v[I]<v[I-1]&&v[I]<v[I+1]&&j.push(I);let Z=-1,G=[];for(let I of j){let B=c[I],z=-1,R=Z+1,J=Number.POSITIVE_INFINITY,H=0;for(;z===-1&&R<_.length&&(H=Math.abs(B-(_[R].x+O[R].x)/2),H<(O[R].x-_[R].x)/2&&(z=R,Z=R),++R,!(H>=J));)J=H;if(z!==-1&&b[I]>T){let K=Math.abs(O[z].x-_[z].x);G.push({id:de(),x:B,y:b[I],width:K,index:I,ddY:v[I],inflectionPoints:{from:_[z],to:O[z]}})}}return m&&et({x:c,y:b},G),G.forEach(I=>{t||(I.y*=-1,I.ddY=I.ddY*-1)}),G.sort((I,B)=>I.x-B.x),G}var Ve=-4*Math.LN2,rt=Math.sqrt(Math.PI/Math.LN2),Ot=Math.sqrt(3),zt=Math.sqrt(2*Math.LN2),Xt=Math.sqrt(2*Math.LN2)-1;var{parse:yc,stringify:vc}=JSON;var{parse:Rc,stringify:Vc}=JSON;var{parse:Uc,stringify:$c}=JSON;window.generateID=de;var $=$||{};$.peakfinder=function(){function n(){var s=document.getElementById("peak-algo").value,m=parseFloat(document.getElementById("min-peak-distance").value),c=document.getElementById("criteria").value!="valleys",g=document.getElementById("peaks-on").value,M=parseFloat(document.getElementById("min-peak-height").value),b=parseFloat(document.getElementById("minMaxRatio").value),A=parseInt(document.getElementById("win-size").value),v=parseInt(document.getElementById("degree").value),F=document.getElementById("top").value!="no",u=document.getElementById("smooth").value!="no",S=wpd.tree.getActiveDataset();wpd.plotDataProvider.setDataSource(S),window.bckdts=window.peaksflag!=S.id?Object.assign({},wpd.plotDataProvider.getData()):window.bckdts,window.peaksflag=S.id;var N=window.bckdts.rawData.slice(0);if(N=t(N,g),g=="X")var T=N.map(C=>C[1]),D=N.map(C=>C[0]);else var T=N.map(_=>_[0]),D=N.map(_=>_[1]);if(s=="Local Maxima")var P=c==!0?e(T,D,M):r(T,D,M);else if(s=="Savitzky-Golay")var P=tt({x:T,y:D},{minMaxRatio:b,realTopDetection:F,maxCriteria:c,smoothY:u,sgOptions:{windowSize:A,polynomial:v}});for(P=l(P,m),g=="X"?(x=P.map(({y:C})=>C),y=P.map(({x:C})=>C)):(x=P.map(({x:C})=>C),y=P.map(({y:C})=>C)),S.clearAll(),i=0;i<P.length;i++)o(x[i],y[i]);S.peaksOn=g,wpd.graphicsWidget.forceHandlerRepaint(),wpd.dataPointCounter.setCount(P.length)}function e(s,m,c){if(!Array.isArray(m)||m.length===0)return[];let g=[],M=m.length-1;for(let b=1;b<M;b++)if(m[b]>m[b-1]&&m[b]>=m[b+1]&&m[b]>=c){let A=b;for(;A>0&&m[A-1]<=m[A];)A--;let v=b;for(;v<M&&m[v+1]<=m[v];)v++;let F=Math.max(s[v],s[A])-Math.min(s[v],s[A]);g.push({index:b,x:s[b],y:m[b],width:F})}return g}function r(s,m,c){if(!Array.isArray(m)||m.length===0)return[];let g=[],M=m.length-1;for(let b=1;b<M;b++)if(m[b]<m[b-1]&&m[b]<=m[b+1]&&m[b]<=c){let A=b;for(;A<0&&m[A-1]>=m[A];)A--;let v=b;for(;v<M&&m[v+1]>=m[v];)v++;let F=Math.max(s[v],s[A])-Math.min(s[v],s[A]);g.push({index:b,x:s[b],y:m[b],width:F})}return g}function l(s,m){if(!Array.isArray(s)||s.length===0)return[];let c=[s[0]];for(let g=1;g<s.length;g++){let M=s[g].x,b=c[c.length-1].x;M-b>=m&&c.push(s[g])}return c}function o(s,m){let c=wpd.tree.getActiveDataset(),M=wpd.appData.getPlotData().getAxesForDataset(c).dataToPixel(s,m);c.addPixel(M.x,M.y)}function t(s,m){let c=new Set,g=[];for(let M of s){let b=m==="Y"?M[0]:M[1];c.has(b)||(g.push(M),c.add(b))}return g.sort((M,b)=>m==="Y"?M[0]-b[0]:M[1]-b[1]),g}return{run_peaks:n}}();$.listeners=function(){function n(m){let c=document.getElementById("win-slider"),g=document.getElementById("win-size");if(m)c.value=m,g.value=m;else{let M=wpd.tree.getActiveDataset()._dataPoints.length>1?wpd.tree.getActiveDataset()._dataPoints.length:200,b=M<1e4?625:M>1e4?parseInt(M/16):M>1e3?parseInt(M/4):M>100?parseInt(M/2):parseInt(M-1),A=M>1e3?4:2;c.min=5,c.max=b,c.step=A}}function e(){let m=document.getElementById("win-size"),c=parseInt(m.value);isNaN(c)||c<5?c=5:c%2===0&&c--;let g=document.getElementById("win-slider");g.value=c,m.value=c}function r(){let m=document.getElementById("win-slider"),c=document.getElementById("win-size");m.min=5,m.max=200,m.step=2,m.addEventListener("input",()=>{$.listeners.w_updateSliderLabel(m.value)}),c.addEventListener("input",()=>{$.listeners.w_updateSliderFromInput()}),$.listeners.w_updateSliderLabel(m.value)}function l(m){let c=document.getElementById("deg-slider");c.value=m;let g=document.getElementById("degree");g.value=m}function o(){let m=document.getElementById("degree"),c=parseInt(m.value);isNaN(c)||c<2?c=2:c>5&&(c=5);let g=document.getElementById("deg-slider");g.value=c,m.value=c}function t(){let m=document.getElementById("deg-slider"),c=document.getElementById("degree");m.min=2,m.max=5,m.step=1,m.addEventListener("input",()=>{$.listeners.d_updateSliderLabel(m.value)}),c.addEventListener("input",()=>{$.listeners.d_updateSliderFromInput()}),$.listeners.d_updateSliderLabel(m.value)}function s(){document.getElementById("peak-algo").addEventListener("change",function(){this.value=="Local Maxima"?(document.getElementById("gsdparams").hidden=!0,document.getElementById("lmparams").hidden=!1):this.value=="Savitzky-Golay"&&(document.getElementById("gsdparams").hidden=!1,document.getElementById("lmparams").hidden=!0)})}return{showgsd:s,w_updateSliderLabel:n,w_updateSliderFromInput:e,w_initSlider:r,d_updateSliderLabel:l,d_updateSliderFromInput:o,d_initSlider:t}}();$.onepager=function(){function n(){wpd.busyNote.show(),pagemanager=wpd.appData.getPageManager();let r=parseInt(document.getElementById("min-page").value),l=parseInt(document.getElementById("max-page").value),o=parseFloat(document.getElementById("scale-page").value);e(r,l,o).then(t=>{console.log("PDF converted to PNG successfully"),wpd.messagePopup.show("Turn 1pager",'Check your "Downloads" folder for a file called "stacked_pages.png"');let s=document.createElement("a");s.href=t,s.download="stacked_pages.png",s.click(),wpd.busyNote.close()}).catch(t=>{wpd.busyNote.close(),wpd.messagePopup.show("Turn 1pager","Error converting PDF to PNG"),console.error("Error converting PDF to PNG:",t)})}async function e(r,l,o){let t=await wpd.appData.getFileManager().files[0].arrayBuffer(),s=await pdfjsLib.getDocument({data:t}).promise,m=document.createElement("canvas"),c=m.getContext("2d"),g=0,M=0;for(let v=r;v<=l;v++){let u=(await s.getPage(v)).getViewport({scale:o});M+=u.height}if(M>32700){o=32700*o/M,M=0;for(let v=r;v<=l;v++){let u=(await s.getPage(v)).getViewport({scale:o});M+=u.height}}let b=await s.getPage(r).then(v=>v.getViewport({scale:o}).width);console.log("scale: ",o),m.width=b,m.height=M;for(let v=r;v<=l;v++){let F=await s.getPage(v),u=F.getViewport({scale:o}),S=document.createElement("canvas"),N=S.getContext("2d");S.width=u.width,S.height=u.height,await F.render({canvasContext:N,viewport:u}).promise,c.drawImage(S,0,g),g+=u.height}return m.toDataURL("image/png")}return{run:n}}();window.softypo=$;window.onload=function(){$.listeners.showgsd(),$.listeners.d_initSlider(),$.listeners.w_initSlider()};})();

(()=>{var xe=Object.create;var zt=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty;var Ct=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var ye=(r,t,n,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ge(t))!we.call(r,o)&&o!==n&&zt(r,o,{get:()=>t[o],enumerable:!(l=pe(t,o))||l.enumerable});return r};var Xt=(r,t,n)=>(n=r!=null?xe(de(r)):{},ye(t||!r||!r.__esModule?zt(n,"default",{value:r,enumerable:!0}):n,r));var jt=Ct((At,qt)=>{(function(r,t){typeof At=="object"&&typeof qt<"u"?t(At):typeof define=="function"&&define.amd?define(["exports"],t):t(r.d3_array={})})(At,function(r){"use strict";function t(f,d){return f<d?-1:f>d?1:f>=d?0:NaN}function n(f){return f.length===1&&(f=l(f)),{left:function(d,p,w,m){for(w==null&&(w=0),m==null&&(m=d.length);w<m;){var c=w+m>>>1;f(d[c],p)<0?w=c+1:m=c}return w},right:function(d,p,w,m){for(w==null&&(w=0),m==null&&(m=d.length);w<m;){var c=w+m>>>1;f(d[c],p)>0?m=c:w=c+1}return w}}}function l(f){return function(d,p){return t(f(d),p)}}var o=n(t),e=o.right,s=o.left;function u(f,d){return d<f?-1:d>f?1:d>=f?0:NaN}function h(f){return f===null?NaN:+f}function g(f,d){var p=f.length,w=0,m,c,E=0,V=-1,W=0;if(d==null)for(;++V<p;)isNaN(m=h(f[V]))||(c=m-w,w+=c/++W,E+=c*(m-w));else for(;++V<p;)isNaN(m=h(d(f[V],V,f)))||(c=m-w,w+=c/++W,E+=c*(m-w));if(W>1)return E/(W-1)}function M(f,d){var p=g(f,d);return p&&Math.sqrt(p)}function b(f,d){var p=-1,w=f.length,m,c,E;if(d==null){for(;++p<w;)if((c=f[p])!=null&&c>=c){m=E=c;break}for(;++p<w;)(c=f[p])!=null&&(m>c&&(m=c),E<c&&(E=c))}else{for(;++p<w;)if((c=d(f[p],p,f))!=null&&c>=c){m=E=c;break}for(;++p<w;)(c=d(f[p],p,f))!=null&&(m>c&&(m=c),E<c&&(E=c))}return[m,E]}function A(f){return function(){return f}}function v(f){return f}function F(f,d,p){f=+f,d=+d,p=(m=arguments.length)<2?(d=f,f=0,1):m<3?1:+p;for(var w=-1,m=Math.max(0,Math.ceil((d-f)/p))|0,c=new Array(m);++w<m;)c[w]=f+w*p;return c}var a=Math.sqrt(50),S=Math.sqrt(10),N=Math.sqrt(2);function T(f,d,p){var w=D(f,d,p);return F(Math.ceil(f/w)*w,Math.floor(d/w)*w+w/2,w)}function D(f,d,p){var w=Math.abs(d-f)/Math.max(0,p),m=Math.pow(10,Math.floor(Math.log(w)/Math.LN10)),c=w/m;return c>=a?m*=10:c>=S?m*=5:c>=N&&(m*=2),d<f?-m:m}function P(f){return Math.ceil(Math.log(f.length)/Math.LN2)+1}function C(f){return+f}function j(){var f=v,d=b,p=P;function w(m){var c,E=m.length,V,W=new Array(E);for(c=0;c<E;++c)W[c]=+f(m[c],c,m);var ut=d(W),tt=+ut[0],et=+ut[1],X=p(W,tt,et);Array.isArray(X)||(X=T(tt,et,+X));var Q=X.length;for(c=0;c<Q;++c)X[c]=+X[c];for(;X[0]<=tt;)X.shift(),--Q;for(;X[Q-1]>=et;)X.pop(),--Q;var mt=new Array(Q+1),ht;for(c=0;c<=Q;++c)ht=mt[c]=[],ht.x0=c>0?X[c-1]:tt,ht.x1=c<Q?X[c]:et;for(c=0;c<E;++c)V=W[c],tt<=V&&V<=et&&mt[e(X,V,0,Q)].push(m[c]);return mt}return w.value=function(m){return arguments.length?(f=typeof m=="function"?m:A(+m),w):f},w.domain=function(m){return arguments.length?(d=typeof m=="function"?m:A([+m[0],+m[1]]),w):d},w.thresholds=function(m){return arguments.length?(p=typeof m=="function"?m:Array.isArray(m)?A(Array.prototype.map.call(m,C)):A(+m),w):p},w}function _(f,d,p){if(p==null&&(p=h),!!(w=f.length)){if((d=+d)<=0||w<2)return+p(f[0],0,f);if(d>=1)return+p(f[w-1],w-1,f);var w,m=(w-1)*d,c=Math.floor(m),E=+p(f[c],c,f),V=+p(f[c+1],c+1,f);return E+(V-E)*(m-c)}}function O(f,d,p){return f.sort(t),Math.ceil((p-d)/(2*(_(f,.75)-_(f,.25))*Math.pow(f.length,-1/3)))}function Z(f,d,p){return Math.ceil((p-d)/(3.5*M(f)*Math.pow(f.length,-1/3)))}function G(f,d){var p=-1,w=f.length,m,c;if(d==null){for(;++p<w;)if((c=f[p])!=null&&c>=c){m=c;break}for(;++p<w;)(c=f[p])!=null&&c>m&&(m=c)}else{for(;++p<w;)if((c=d(f[p],p,f))!=null&&c>=c){m=c;break}for(;++p<w;)(c=d(f[p],p,f))!=null&&c>m&&(m=c)}return m}function I(f,d){var p=0,w=f.length,m,c=-1,E=w;if(d==null)for(;++c<w;)isNaN(m=h(f[c]))?--E:p+=m;else for(;++c<w;)isNaN(m=h(d(f[c],c,f)))?--E:p+=m;if(E)return p/E}function B(f,d){var p=[],w=f.length,m,c=-1;if(d==null)for(;++c<w;)isNaN(m=h(f[c]))||p.push(m);else for(;++c<w;)isNaN(m=h(d(f[c],c,f)))||p.push(m);return _(p.sort(t),.5)}function z(f){for(var d=f.length,p,w=-1,m=0,c,E;++w<d;)m+=f[w].length;for(c=new Array(m);--d>=0;)for(E=f[d],p=E.length;--p>=0;)c[--m]=E[p];return c}function R(f,d){var p=-1,w=f.length,m,c;if(d==null){for(;++p<w;)if((c=f[p])!=null&&c>=c){m=c;break}for(;++p<w;)(c=f[p])!=null&&m>c&&(m=c)}else{for(;++p<w;)if((c=d(f[p],p,f))!=null&&c>=c){m=c;break}for(;++p<w;)(c=d(f[p],p,f))!=null&&m>c&&(m=c)}return m}function J(f){for(var d=0,p=f.length-1,w=f[0],m=new Array(p<0?0:p);d<p;)m[d]=[w,w=f[++d]];return m}function H(f,d){for(var p=d.length,w=new Array(p);p--;)w[p]=f[d[p]];return w}function K(f,d){if(w=f.length){var p=0,w,m=0,c,E=f[m];for(d||(d=t);++p<w;)(d(c=f[p],E)<0||d(E,E)!==0)&&(E=c,m=p);if(d(E,E)===0)return m}}function lt(f,d,p){for(var w=(p??f.length)-(d=d==null?0:+d),m,c;w;)c=Math.random()*w--|0,m=f[w+d],f[w+d]=f[c+d],f[c+d]=m;return f}function st(f,d){var p=0,w=f.length,m,c=-1;if(d==null)for(;++c<w;)(m=+f[c])&&(p+=m);else for(;++c<w;)(m=+d(f[c],c,f))&&(p+=m);return p}function ot(f){if(!(c=f.length))return[];for(var d=-1,p=R(f,ft),w=new Array(p);++d<p;)for(var m=-1,c,E=w[d]=new Array(c);++m<c;)E[m]=f[m][d];return w}function ft(f){return f.length}function ct(){return ot(arguments)}var at="0.7.1";r.version=at,r.bisect=e,r.bisectRight=e,r.bisectLeft=s,r.ascending=t,r.bisector=n,r.descending=u,r.deviation=M,r.extent=b,r.histogram=j,r.thresholdFreedmanDiaconis=O,r.thresholdScott=Z,r.thresholdSturges=P,r.max=G,r.mean=I,r.median=B,r.merge=z,r.min=R,r.pairs=J,r.permute=H,r.quantile=_,r.range=F,r.scan=K,r.shuffle=lt,r.sum=st,r.ticks=T,r.tickStep=D,r.transpose=ot,r.variance=g,r.zip=ct})});var Wt=Ct(($e,Gt)=>{var{bisectRight:Ae}=jt(),Ie=(r,t,n,l)=>{let o=r.length-1;r[0]=0,t[0]=0,n[0]=0,t[1]=t[1]/r[1],n[1]=n[1]/r[1];for(let e=2;e<o;++e)r[e]=r[e]-r[e-2]*n[e-2]*n[e-2]-r[e-1]*t[e-1]*t[e-1],t[e]=(t[e]-r[e-1]*t[e-1]*n[e-1])/r[e],n[e]=n[e]/r[e];for(let e=2;e<o;++e)l[e]=l[e]-t[e-1]*l[e-1]-n[e-2]*l[e-2];for(let e=1;e<o;++e)l[e]=l[e]/r[e];l[o-2]=l[o-2]-t[o-2]*l[o-1];for(let e=o-3;e>0;--e)l[e]=l[e]-t[e]*l[e+1]-n[e]*l[e+2]},Fe=(r,t,n,l)=>{let o=r.length-1,e=new Array(o+1),s=new Array(o+1),u=new Array(o+1),h=new Array(o+1),g=new Array(o+1),M=new Array(o+1),b=new Array(o+1),A=new Array(o+1),v=r.map(()=>[0,0,0,0]);v.pop();let F=2*(1-l)/(3*l);for(let a=0;a<o;++a)e[a]=r[a+1]-r[a],s[a]=3/e[a];g[0]=0;for(let a=1;a<o;++a)u[a]=-(s[a-1]+s[a]),h[a]=2*(r[a+1]-r[a-1]),g[a]=3*(t[a+1]-t[a])/e[a]-3*(t[a]-t[a-1])/e[a-1];g[o]=0;for(let a=1;a<o;++a)M[a]=s[a-1]*s[a-1]*n[a-1]+u[a]*u[a]*n[a]+s[a]*s[a]*n[a+1],M[a]=F*M[a]+h[a];for(let a=1;a<o-1;++a)b[a]=u[a]*s[a]*n[a]+s[a]*u[a+1]*n[a+1],b[a]=F*b[a]+e[a];for(let a=1;a<o-2;++a)A[a]=F*s[a]*s[a+1]*n[a+1];Ie(M,b,A,g),v[0][3]=t[0]-F*s[0]*g[1]*n[0],v[1][3]=t[1]-F*(u[1]*g[1]+s[1]*g[2])*n[0],v[0][0]=g[1]/(3*e[0]),v[0][1]=0,v[0][2]=(v[1][3]-v[0][3])/e[0]-g[1]*e[0]/3,s[0]=0;for(let a=1;a<o;++a)v[a][0]=(g[a+1]-g[a])/(3*e[a]),v[a][1]=g[a],v[a][2]=(g[a]+g[a-1])*e[a-1]+v[a-1][2],v[a][3]=s[a-1]*g[a-1]+u[a]*g[a]+s[a]*g[a+1],v[a][3]=t[a]-F*v[a][3]*n[a];return v},_t=class{constructor(t,n,l=1){let o=t.map((g,M)=>M);o.sort((g,M)=>t[g]-t[M]);let e=o.map(g=>t[g]),s=o.map(g=>n[g]),u=o.length,h=o.map(()=>1);this.n=u,this.x=e,this.y=s,this.params=Fe(e,s,h,l)}interpolate(t){if(t===this.x[this.n-1])return this.y[this.n-1];let n=Math.min(Math.max(0,Ae(this.x,t)-1),this.n-2),[l,o,e,s]=this.params[n];return t=t-this.x[n],l*t*t*t+o*t*t+e*t+s}max(t=100){let n=this.x[0],o=(this.x[this.n-1]-n)/t,e=-1/0;for(let s=0,u=n;s<t;++s,u+=o){let h=this.interpolate(u);h>e&&(e=h)}return e}min(t=100){let n=this.x[0],o=(this.x[this.n-1]-n)/t,e=1/0;for(let s=0,u=n;s<t;++s,u+=o){let h=this.interpolate(u);h<e&&(e=h)}return e}domain(){return[this.x[0],this.x[this.x.length-1]]}range(){return[this.min(),this.max()]}curve(t,n=null){n=n||this.domain();let l=(n[1]-n[0])/(t-1),o=new Array(t);for(let e=0;e<t;++e){let s=l*e+n[0];o[e]=[s,this.interpolate(s)]}return o}};Gt.exports=_t});var Ut=Ct((xn,Ht)=>{"use strict";function U(r){if(this.size=r|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=r<<1;for(var t=new Array(this.size*2),n=0;n<t.length;n+=2){let h=Math.PI*n/this.size;t[n]=Math.cos(h),t[n+1]=-Math.sin(h)}this.table=t;for(var l=0,o=1;this.size>o;o<<=1)l++;this._width=l%2===0?l-1:l,this._bitrev=new Array(1<<this._width);for(var e=0;e<this._bitrev.length;e++){this._bitrev[e]=0;for(var s=0;s<this._width;s+=2){var u=this._width-s-2;this._bitrev[e]|=(e>>>s&3)<<u}}this._out=null,this._data=null,this._inv=0}Ht.exports=U;U.prototype.fromComplexArray=function(t,n){for(var l=n||new Array(t.length>>>1),o=0;o<t.length;o+=2)l[o>>>1]=t[o];return l};U.prototype.createComplexArray=function(){let t=new Array(this._csize);for(var n=0;n<t.length;n++)t[n]=0;return t};U.prototype.toComplexArray=function(t,n){for(var l=n||this.createComplexArray(),o=0;o<l.length;o+=2)l[o]=t[o>>>1],l[o+1]=0;return l};U.prototype.completeSpectrum=function(t){for(var n=this._csize,l=n>>>1,o=2;o<l;o+=2)t[n-o]=t[o],t[n-o+1]=-t[o+1]};U.prototype.transform=function(t,n){if(t===n)throw new Error("Input and output buffers must be different");this._out=t,this._data=n,this._inv=0,this._transform4(),this._out=null,this._data=null};U.prototype.realTransform=function(t,n){if(t===n)throw new Error("Input and output buffers must be different");this._out=t,this._data=n,this._inv=0,this._realTransform4(),this._out=null,this._data=null};U.prototype.inverseTransform=function(t,n){if(t===n)throw new Error("Input and output buffers must be different");this._out=t,this._data=n,this._inv=1,this._transform4();for(var l=0;l<t.length;l++)t[l]/=this.size;this._out=null,this._data=null};U.prototype._transform4=function(){var t=this._out,n=this._csize,l=this._width,o=1<<l,e=n/o<<1,s,u,h=this._bitrev;if(e===4)for(s=0,u=0;s<n;s+=e,u++){let a=h[u];this._singleTransform2(s,a,o)}else for(s=0,u=0;s<n;s+=e,u++){let a=h[u];this._singleTransform4(s,a,o)}var g=this._inv?-1:1,M=this.table;for(o>>=2;o>=2;o>>=2){e=n/o<<1;var b=e>>>2;for(s=0;s<n;s+=e)for(var A=s+b,v=s,F=0;v<A;v+=2,F+=o){let a=v,S=a+b,N=S+b,T=N+b,D=t[a],P=t[a+1],C=t[S],j=t[S+1],_=t[N],O=t[N+1],Z=t[T],G=t[T+1],I=D,B=P,z=M[F],R=g*M[F+1],J=C*z-j*R,H=C*R+j*z,K=M[2*F],lt=g*M[2*F+1],st=_*K-O*lt,ot=_*lt+O*K,ft=M[3*F],ct=g*M[3*F+1],at=Z*ft-G*ct,f=Z*ct+G*ft,d=I+st,p=B+ot,w=I-st,m=B-ot,c=J+at,E=H+f,V=g*(J-at),W=g*(H-f),ut=d+c,tt=p+E,et=d-c,X=p-E,Q=w+W,mt=m-V,ht=w-W,Nt=m+V;t[a]=ut,t[a+1]=tt,t[S]=Q,t[S+1]=mt,t[N]=et,t[N+1]=X,t[T]=ht,t[T+1]=Nt}}};U.prototype._singleTransform2=function(t,n,l){let o=this._out,e=this._data,s=e[n],u=e[n+1],h=e[n+l],g=e[n+l+1],M=s+h,b=u+g,A=s-h,v=u-g;o[t]=M,o[t+1]=b,o[t+2]=A,o[t+3]=v};U.prototype._singleTransform4=function(t,n,l){let o=this._out,e=this._data,s=this._inv?-1:1,u=l*2,h=l*3,g=e[n],M=e[n+1],b=e[n+l],A=e[n+l+1],v=e[n+u],F=e[n+u+1],a=e[n+h],S=e[n+h+1],N=g+v,T=M+F,D=g-v,P=M-F,C=b+a,j=A+S,_=s*(b-a),O=s*(A-S),Z=N+C,G=T+j,I=D+O,B=P-_,z=N-C,R=T-j,J=D-O,H=P+_;o[t]=Z,o[t+1]=G,o[t+2]=I,o[t+3]=B,o[t+4]=z,o[t+5]=R,o[t+6]=J,o[t+7]=H};U.prototype._realTransform4=function(){var t=this._out,n=this._csize,l=this._width,o=1<<l,e=n/o<<1,s,u,h=this._bitrev;if(e===4)for(s=0,u=0;s<n;s+=e,u++){let Tt=h[u];this._singleRealTransform2(s,Tt>>>1,o>>>1)}else for(s=0,u=0;s<n;s+=e,u++){let Tt=h[u];this._singleRealTransform4(s,Tt>>>1,o>>>1)}var g=this._inv?-1:1,M=this.table;for(o>>=2;o>=2;o>>=2){e=n/o<<1;var b=e>>>1,A=b>>>1,v=A>>>1;for(s=0;s<n;s+=e)for(var F=0,a=0;F<=v;F+=2,a+=o){var S=s+F,N=S+A,T=N+A,D=T+A,P=t[S],C=t[S+1],j=t[N],_=t[N+1],O=t[T],Z=t[T+1],G=t[D],I=t[D+1],B=P,z=C,R=M[a],J=g*M[a+1],H=j*R-_*J,K=j*J+_*R,lt=M[2*a],st=g*M[2*a+1],ot=O*lt-Z*st,ft=O*st+Z*lt,ct=M[3*a],at=g*M[3*a+1],f=G*ct-I*at,d=G*at+I*ct,p=B+ot,w=z+ft,m=B-ot,c=z-ft,E=H+f,V=K+d,W=g*(H-f),ut=g*(K-d),tt=p+E,et=w+V,X=m+ut,Q=c-W;if(t[S]=tt,t[S+1]=et,t[N]=X,t[N+1]=Q,F===0){var mt=p-E,ht=w-V;t[T]=mt,t[T+1]=ht;continue}if(F!==v){var Nt=m,re=-c,oe=p,ie=-w,le=-g*ut,se=-g*W,fe=-g*V,ce=-g*E,ae=Nt+le,ue=re+se,me=oe+ce,he=ie-fe,Yt=s+A-F,Ot=s+b-F;t[Yt]=ae,t[Yt+1]=ue,t[Ot]=me,t[Ot+1]=he}}}};U.prototype._singleRealTransform2=function(t,n,l){let o=this._out,e=this._data,s=e[n],u=e[n+l],h=s+u,g=s-u;o[t]=h,o[t+1]=0,o[t+2]=g,o[t+3]=0};U.prototype._singleRealTransform4=function(t,n,l){let o=this._out,e=this._data,s=this._inv?-1:1,u=l*2,h=l*3,g=e[n],M=e[n+l],b=e[n+u],A=e[n+h],v=g+b,F=g-b,a=M+A,S=s*(M-A),N=v+a,T=F,D=-S,P=v-a,C=F,j=S;o[t]=N,o[t+1]=0,o[t+2]=T,o[t+3]=D,o[t+4]=P,o[t+5]=0,o[t+6]=C,o[t+7]=j}});var xt=256,bt=[],Mt;for(;xt--;)bt[xt]=(xt+256).toString(16).substring(1);function dt(){var r=0,t,n="";if(!Mt||xt+16>256){for(Mt=Array(r=256);r--;)Mt[r]=256*Math.random()|0;r=xt=0}for(;r<16;r++)t=Mt[xt+r],r==6?n+=bt[t&15|64]:r==8?n+=bt[t&63|128]:n+=bt[t],r&1&&r>1&&r<11&&(n+="-");return xt++,n}var ve=Object.prototype.toString;function L(r){let t=ve.call(r);return t.endsWith("Array]")&&!t.includes("Big")}function pt(r,t,n={}){let{windowSize:l=9,derivative:o=0,polynomial:e=3}=n;if(l%2===0||l<5||!Number.isInteger(l))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(!L(r))throw new TypeError("Y values must be an array");if(typeof t>"u")throw new TypeError("X must be defined");if(l>r.length)throw new RangeError(`Window size is higher than the data length ${l}>${r.length}`);if(o<0||!Number.isInteger(o))throw new RangeError("Derivative should be a positive integer");if(e<1||!Number.isInteger(e))throw new RangeError("Polynomial should be a positive integer");e>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");let s=Math.floor(l/2),u=r.length,h=new Float64Array(u),g=be(l,e,o),M=0,b=!0;L(t)?b=!1:M=Math.pow(t,o);for(let v=0;v<s;v++){let F=g[s-v-1],a=g[s+v+1],S=0,N=0;for(let T=0;T<l;T++)S+=F[T]*r[T],N+=a[T]*r[u-l+T];b?(h[s-v-1]=S/M,h[u-s+v]=N/M):(M=Pt(t,s-v-1,s,o),h[s-v-1]=S/M,M=Pt(t,u-s+v,s,o),h[u-s+v]=N/M)}let A=g[s];for(let v=l;v<=u;v++){let F=0;for(let a=0;a<l;a++)F+=A[a]*r[a+v-l];b||(M=Pt(t,v-s-1,s,o)),h[v-s-1]=F/M}return h}function Pt(r,t,n,l){let o=0,e=0;for(let s=t-n;s<t+n;s++)s>=0&&s<r.length-1&&(o+=r[s+1]-r[s],e++);return Math.pow(o/e,l)}function yt(r,t,n,l){let o=0;return n>0?o=(4*n-2)/(n*(2*t-n+1))*(r*yt(r,t,n-1,l)+l*yt(r,t,n-1,l-1))-(n-1)*(2*t+n)/(n*(2*t-n+1))*yt(r,t,n-2,l):n===0&&l===0?o=1:o=0,o}function Lt(r,t){let n=1;if(r>=t)for(let l=r-t+1;l<=r;l++)n*=l;return n}function Me(r,t,n,l,o){let e=0;for(let s=0;s<=l;s++)e+=(2*s+1)*(Lt(2*n,s)/Lt(2*n+s+1,s+1))*yt(r,n,s,0)*yt(t,n,s,o);return e}function be(r,t,n){let l=new Array(r),o=Math.floor(r/2);for(let e=-o;e<=o;e++){l[e+o]=new Float64Array(r);for(let s=-o;s<=o;s++)l[e+o][s+o]=Me(s,e,o,t,n)}return l}var Ee=Xt(Wt());var Se=Xt(Ut());function it(r){if(!L(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");let t=r.slice(),n=0,l=t.length-1,o=0,e=0,s=0,u=$t(n,l);for(;;){if(l<=n)return t[u];if(l===n+1)return t[n]>t[l]&&gt(t,n,l),t[u];for(o=$t(n,l),t[o]>t[l]&&gt(t,o,l),t[n]>t[l]&&gt(t,n,l),t[o]>t[n]&&gt(t,o,n),gt(t,o,n+1),e=n+1,s=l;;){do e++;while(t[n]>t[e]);do s--;while(t[s]>t[n]);if(s<e)break;gt(t,e,s)}gt(t,n,s),s<=u&&(n=e),s>=u&&(l=s-1)}}function gt(r,t,n){let l=r[n];r[n]=r[t],r[t]=l}function $t(r,t){return Math.floor((r+t)/2)}function Y(r,t={}){let{minLength:n}=t;if(!L(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");if(n&&r.length<n)throw new Error(`input must have a length of at least ${n}`)}function nt(r,t,n={}){let{sorted:l=!0}=n;if(l){let o=0,e=r.length-1,s=0;for(;e-o>1;)if(s=o+(e-o>>1),r[s]<t)o=s;else if(r[s]>t)e=s;else return s;return o<r.length-1?Math.abs(t-r[o])<Math.abs(r[o+1]-t)?o:o+1:o}else{let o=0,e=Number.POSITIVE_INFINITY;for(let s=0;s<r.length;s++){let u=Math.abs(r[s]-t);u<e&&(e=u,o=s)}return o}}function q(r,t={}){let{fromIndex:n,toIndex:l}=t,{from:o,to:e}=t;return n===void 0&&(o!==void 0?n=nt(r,o):n=0),l===void 0&&(e!==void 0?l=nt(r,e):l=r.length-1),n<0&&(n=0),l<0&&(l=0),n>=r.length&&(n=r.length-1),l>=r.length&&(l=r.length-1),n>l&&([n,l]=[l,n]),{fromIndex:n,toIndex:l}}function rt(r,t={}){Y(r);let{fromIndex:n,toIndex:l}=q(r,t),o=r[n];for(let e=n+1;e<=l;e++)r[e]>o&&(o=r[e]);return o}function wt(r,t={}){Y(r);let{fromIndex:n,toIndex:l}=q(r,t),o=r[n];for(let e=n+1;e<=l;e++)r[e]<o&&(o=r[e]);return o}function Zt(r,t={}){if(r.length<3)return!0;let{tolerance:n=.05}=t,l=0,o=Number.MAX_SAFE_INTEGER;for(let e=0;e<r.length-1;++e){let s=r[e+1]-r[e];s<o&&(o=s),s>l&&(l=s)}return(l-o)/l<n}function It(r){if(r.length<=2)return 1;if(r[0]===r[1]){for(let t=1;t<r.length-1;t++)if(r[t]!==r[t+1])return 0;return 1}if(r[0]<r[r.length-1]){for(let t=0;t<r.length-1;t++)if(r[t]>=r[t+1])return 0;return 1}else{for(let t=0;t<r.length-1;t++)if(r[t]<=r[t+1])return 0;return-1}}function Jt(r){let t=it(r),n=new Float64Array(r.length);for(let l=0;l<r.length;l++)n[l]=Math.abs(r[l]-t);return{median:t,mad:it(n)}}function Dt(r){let{mad:t,median:n}=Jt(r);return{sd:t/.6744897501960817,mad:t,median:n}}function te(r,t){let{x:n,y:l}=r;for(let o of t){let e=o.index;if(l[e-1]>=l[e-2]&&l[e-1]>=l[e]?e--:l[e+1]>=l[e]&&l[e+1]>=l[e+2]?e++:l[e-2]>=l[e-3]&&l[e-2]>=l[e-1]?e-=2:l[e+2]>=l[e+1]&&l[e+2]>=l[e+3]&&(e+=2),l[e-1]>0&&l[e+1]>0&&l[e]>=l[e-1]&&l[e]>=l[e+1]&&(l[e]!==l[e-1]||l[e]!==l[e+1])){let s=20*Math.log10(l[e-1]),u=20*Math.log10(l[e]),h=20*Math.log10(l[e+1]),g=.5*(s-h)/(s-2*u+h);o.x=n[e]+(n[e]-n[e-1])*g,o.y=l[e]-.25*(l[e-1]-l[e+1])*g}}}function ee(r,t={}){let{sgOptions:n={windowSize:9,polynomial:3},noiseLevel:l,smoothY:o=!1,maxCriteria:e=!0,minMaxRatio:s=25e-5,realTopDetection:u=!1}=t,{x:h,y:g}=r;if(It(h)!==1)throw new Error("GSD only accepts monotone increasing x values");g=g.slice();let M=Zt(h);if(l===void 0)if(M){let I=Dt(g);e?l=I.median+1.5*I.sd:l=-I.median+1.5*I.sd}else l=0;else e||(l*=-1);if(!e)for(let I=0;I<g.length;I++)g[I]*=-1;if(l!==void 0)for(let I=0;I<g.length;I++)g[I]<l&&(g[I]=l);let b=g,A,v,{windowSize:F,polynomial:a}=n;M?(o&&(b=pt(g,h[1]-h[0],{windowSize:F,polynomial:a,derivative:0})),A=pt(g,h[1]-h[0],{windowSize:F,polynomial:a,derivative:1}),v=pt(g,h[1]-h[0],{windowSize:F,polynomial:a,derivative:2})):(o&&(b=pt(g,h,{windowSize:F,polynomial:a,derivative:0})),A=pt(g,h,{windowSize:F,polynomial:a,derivative:1}),v=pt(g,h,{windowSize:F,polynomial:a,derivative:2}));let S=wt(b),N=rt(b);if(S>N||S===N)return[];let T=S+(N-S)*s,D=h[1]-h[0],P=null,C=null,j=[],_=[],O=[];for(let I=1;I<b.length-1;++I)(A[I]<A[I-1]&&A[I]<=A[I+1]||A[I]<=A[I-1]&&A[I]<A[I+1])&&(C={x:h[I],index:I},D>0&&P!==null&&(_.push(P),O.push(C))),(A[I]>=A[I-1]&&A[I]>A[I+1]||A[I]>A[I-1]&&A[I]>=A[I+1])&&(P={x:h[I],index:I},D<0&&C!==null&&(_.push(P),O.push(C))),v[I]<v[I-1]&&v[I]<v[I+1]&&j.push(I);let Z=-1,G=[];for(let I of j){let B=h[I],z=-1,R=Z+1,J=Number.POSITIVE_INFINITY,H=0;for(;z===-1&&R<_.length&&(H=Math.abs(B-(_[R].x+O[R].x)/2),H<(O[R].x-_[R].x)/2&&(z=R,Z=R),++R,!(H>=J));)J=H;if(z!==-1&&b[I]>T){let K=Math.abs(O[z].x-_[z].x);G.push({id:dt(),x:B,y:b[I],width:K,index:I,ddY:v[I],inflectionPoints:{from:_[z],to:O[z]}})}}return u&&te({x:h,y:b},G),G.forEach(I=>{e||(I.y*=-1,I.ddY=I.ddY*-1)}),G.sort((I,B)=>I.x-B.x),G}var Vt=-4*Math.LN2,ne=Math.sqrt(Math.PI/Math.LN2),Oe=Math.sqrt(3),ze=Math.sqrt(2*Math.LN2),Xe=Math.sqrt(2*Math.LN2)-1;var{parse:yh,stringify:vh}=JSON;var{parse:Rh,stringify:Vh}=JSON;var{parse:Uh,stringify:$h}=JSON;window.generateID=dt;var $=$||{};$.peakfinder=function(){function r(){var s=document.getElementById("peak-algo").value,u=parseFloat(document.getElementById("min-peak-distance").value),h=document.getElementById("criteria").value!="valleys",g=document.getElementById("peaks-on").value,M=parseFloat(document.getElementById("min-peak-height").value),b=parseFloat(document.getElementById("minMaxRatio").value),A=parseInt(document.getElementById("win-size").value),v=parseInt(document.getElementById("degree").value),F=document.getElementById("top").value!="no",a=document.getElementById("smooth").value!="no",S=wpd.tree.getActiveDataset();wpd.plotDataProvider.setDataSource(S),window.bckdts=window.peaksflag!=S.id?Object.assign({},wpd.plotDataProvider.getData()):window.bckdts,window.peaksflag=S.id;var N=window.bckdts.rawData.slice(0);if(N=e(N,g),g=="X")var T=N.map(C=>C[1]),D=N.map(C=>C[0]);else var T=N.map(_=>_[0]),D=N.map(_=>_[1]);if(s=="Local Maxima")var P=h==!0?t(T,D,M):n(T,D,M);else if(s=="Savitzky-Golay")var P=ee({x:T,y:D},{minMaxRatio:b,realTopDetection:F,maxCriteria:h,smoothY:a,sgOptions:{windowSize:A,polynomial:v}});for(P=l(P,u),g=="X"?(x=P.map(({y:C})=>C),y=P.map(({x:C})=>C)):(x=P.map(({x:C})=>C),y=P.map(({y:C})=>C)),S.clearAll(),i=0;i<P.length;i++)o(x[i],y[i]);S.peaksOn=g,wpd.graphicsWidget.forceHandlerRepaint(),wpd.dataPointCounter.setCount(P.length)}function t(s,u,h){if(!Array.isArray(u)||u.length===0)return[];let g=[],M=u.length-1;for(let b=1;b<M;b++)if(u[b]>u[b-1]&&u[b]>=u[b+1]&&u[b]>=h){let A=b;for(;A>0&&u[A-1]<=u[A];)A--;let v=b;for(;v<M&&u[v+1]<=u[v];)v++;let F=Math.max(s[v],s[A])-Math.min(s[v],s[A]);g.push({index:b,x:s[b],y:u[b],width:F})}return g}function n(s,u,h){if(!Array.isArray(u)||u.length===0)return[];let g=[],M=u.length-1;for(let b=1;b<M;b++)if(u[b]<u[b-1]&&u[b]<=u[b+1]&&u[b]<=h){let A=b;for(;A<0&&u[A-1]>=u[A];)A--;let v=b;for(;v<M&&u[v+1]>=u[v];)v++;let F=Math.max(s[v],s[A])-Math.min(s[v],s[A]);g.push({index:b,x:s[b],y:u[b],width:F})}return g}function l(s,u){if(!Array.isArray(s)||s.length===0)return[];let h=[s[0]];for(let g=1;g<s.length;g++){let M=s[g].x,b=h[h.length-1].x;M-b>=u&&h.push(s[g])}return h}function o(s,u){let h=wpd.tree.getActiveDataset(),M=wpd.appData.getPlotData().getAxesForDataset(h).dataToPixel(s,u);h.addPixel(M.x,M.y)}function e(s,u){let h=new Set,g=[];for(let M of s){let b=u==="Y"?M[0]:M[1];h.has(b)||(g.push(M),h.add(b))}return g.sort((M,b)=>u==="Y"?M[0]-b[0]:M[1]-b[1]),g}return{run_peaks:r}}();$.listeners=function(){function r(u){let h=document.getElementById("win-slider"),g=document.getElementById("win-size");if(u)h.value=u,g.value=u;else{let M=wpd.tree.getActiveDataset()._dataPoints.length>1?wpd.tree.getActiveDataset()._dataPoints.length:200,b=M<1e4?625:M>1e4?parseInt(M/16):M>1e3?parseInt(M/4):M>100?parseInt(M/2):parseInt(M-1),A=M>1e3?4:2;h.min=5,h.max=b,h.step=A}}function t(){let u=document.getElementById("win-size"),h=parseInt(u.value);isNaN(h)||h<5?h=5:h%2===0&&h--;let g=document.getElementById("win-slider");g.value=h,u.value=h}function n(){let u=document.getElementById("win-slider"),h=document.getElementById("win-size");u.min=5,u.max=200,u.step=2,u.addEventListener("input",()=>{$.listeners.w_updateSliderLabel(u.value)}),h.addEventListener("input",()=>{$.listeners.w_updateSliderFromInput()}),$.listeners.w_updateSliderLabel(u.value)}function l(u){let h=document.getElementById("deg-slider");h.value=u;let g=document.getElementById("degree");g.value=u}function o(){let u=document.getElementById("degree"),h=parseInt(u.value);isNaN(h)||h<2?h=2:h>5&&(h=5);let g=document.getElementById("deg-slider");g.value=h,u.value=h}function e(){let u=document.getElementById("deg-slider"),h=document.getElementById("degree");u.min=2,u.max=5,u.step=1,u.addEventListener("input",()=>{$.listeners.d_updateSliderLabel(u.value)}),h.addEventListener("input",()=>{$.listeners.d_updateSliderFromInput()}),$.listeners.d_updateSliderLabel(u.value)}function s(){document.getElementById("peak-algo").addEventListener("change",function(){this.value=="Local Maxima"?(document.getElementById("gsdparams").hidden=!0,document.getElementById("lmparams").hidden=!1):this.value=="Savitzky-Golay"&&(document.getElementById("gsdparams").hidden=!1,document.getElementById("lmparams").hidden=!0)})}return{showgsd:s,w_updateSliderLabel:r,w_updateSliderFromInput:t,w_initSlider:n,d_updateSliderLabel:l,d_updateSliderFromInput:o,d_initSlider:e}}();$.onepager=function(){function r(){wpd.busyNote.show(),pagemanager=wpd.appData.getPageManager();let n=parseInt(document.getElementById("min-page").value),l=parseInt(document.getElementById("max-page").value),o=parseFloat(document.getElementById("scale-page").value);t(n,l,o).then(e=>{console.log("PDF converted to PNG successfully"),wpd.messagePopup.show("Turn 1pager",'Check your "Downloads" folder for a file called "stacked_pages.png"');let s=document.createElement("a");s.href=e,s.download="stacked_pages.png",s.click(),wpd.busyNote.close()}).catch(e=>{wpd.busyNote.close(),wpd.messagePopup.show("Turn 1pager","Error converting PDF to PNG"),console.error("Error converting PDF to PNG:",e)})}async function t(n,l,o){let e=await wpd.appData.getFileManager().files[0].arrayBuffer(),s=await pdfjsLib.getDocument({data:e}).promise,u=document.createElement("canvas"),h=u.getContext("2d"),g=0,M=0;for(let v=n;v<=l;v++){let a=(await s.getPage(v)).getViewport({scale:o});M+=a.height}if(M>32700){o=32700*o/M,M=0;for(let v=n;v<=l;v++){let a=(await s.getPage(v)).getViewport({scale:o});M+=a.height}}let b=await s.getPage(n).then(v=>v.getViewport({scale:o}).width);console.log("scale: ",o),u.width=b,u.height=M;for(let v=n;v<=l;v++){let F=await s.getPage(v),a=F.getViewport({scale:o}),S=document.createElement("canvas"),N=S.getContext("2d");S.width=a.width,S.height=a.height,await F.render({canvasContext:N,viewport:a}).promise,h.drawImage(S,0,g),g+=a.height}return u.toDataURL("image/png")}return{run:r}}();window.softypo=$;window.onload=function(){$.listeners.showgsd(),$.listeners.d_initSlider(),$.listeners.w_initSlider()};})();
